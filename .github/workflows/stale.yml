# ================================================================
# Stale Issue and PR Management
# ================================================================
# Marks issues stale after 7 days of inactivity, closes after 14.
# Marks PRs stale after 5 days, closes after 10.
#
# Exempt labels — issues/PRs with these labels are never marked stale:
#   standup, weekly-summary, pinned, blocked, wip, in-progress
#
# Runs daily at 06:00 UTC (before any standup).
# Use workflow_dispatch to trigger manually.
# ================================================================

name: Stale

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    name: Mark and close stale items
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9
        with:
          # ── Issues ───────────────────────────────────────────────────
          stale-issue-label: "stale"
          days-before-stale: 7
          days-before-close: 14
          stale-issue-message: >
            This issue has been inactive for 7 days.
            If it's still relevant, leave a comment or remove the `stale` label to reset the timer.
          close-issue-message: >
            Closing after 14 days of inactivity.
            Reopen at any time if this is still relevant.
          close-issue-label: "wont-fix"

          # ── Pull Requests ─────────────────────────────────────────────
          stale-pr-label: "stale"
          days-before-pr-stale: 5
          days-before-pr-close: 10
          stale-pr-message: >
            This PR has been inactive for 5 days.
            Update the branch, push a commit, or close it if the work is abandoned.
          close-pr-message: >
            Closing after 10 days of inactivity.
            Reopen if you want to continue this work.

          # ── Exempt labels ─────────────────────────────────────────────
          exempt-issue-labels: "standup,weekly-summary,pinned,blocked,in-progress"
          exempt-pr-labels: "blocked,wip,in-progress"

          # ── Exempt all open milestones ─────────────────────────────────
          exempt-all-milestones: true

          # ── Limit operations per run to avoid rate limits ─────────────
          operations-per-run: 30
